## 1. 系统架构设计
### 1.1 总体架构
采用前后端分离架构：

```plain
客户端（浏览器） → 前端应用（Vue3） → 后端API（SpringBoot3） → 数据库/文件存储
```

### 1.2 技术栈详情
| **模块** | **技术选型** | **作用说明** |
| :--- | :--- | :--- |
| 前端| Vue3 + TypeScript| 组件化开发，类型约束保证代码健壮性|
| 前端| Vite3| 快速构建工具，提升开发效率|
| 前端| Element Plus| 提供 UI 组件（上传、表格、表单等）|
| 前端| Pinia| 状态管理（存储登录用户、全局配置等）|
| 后端| Java17 + SpringBoot3| 后端开发框架，支持模块化和依赖注入|
| 后端| Sa-Token| 处理登录认证、Token 管理|
| 后端| MyBatis-Plus| 简化数据库 CRUD 操作，支持分页、条件查询|
| 后端| Redis| 缓存用户会话、分享链接有效期|
| 后端| MySQL| 存储用户、论文、文件夹等结构化数据|
| 后端| Druid| 数据库连接池，监控 SQL 执行|
| 文件存储| 服务器本地磁盘| 存储上传的论文文件（路径记录在数据库）|


## 2. 数据库设计
### 2.1 核心表结构
#### 用户表（user）
| **字段名** | **类型** | **说明** |
| :--- | :--- | :--- |
| id| bigint| 主键（自增）|
| username| varchar(50)| 用户名（唯一）|
| password| varchar(100)| 加密密码（BCrypt）|
| create_time| datetime| 创建时间|
| update_time| datetime| 更新时间|


#### 论文表（paper）
| **字段名** | **类型** | **说明** |
| :--- | :--- | :--- |
| id| bigint| 主键|
| title| varchar(255)| 论文标题|
| author| varchar(255)| 作者|
| publish_time| date| 发表时间|
| journal| varchar(100)| 发表期刊|
| journal_type| varchar(50)| 期刊类型（如 SCI / 核心）|
| research_direction| text| 研究方向|
| innovation| text| 创新点|
| deficiency| text| 不足|
| file_path| varchar(255)| 文件存储路径|
| file_size| bigint| 文件大小（字节）|
| file_hash| varchar(64)| 文件 MD5 哈希（去重）|
| keywords| varchar(255)| 关键词（逗号分隔）|
| create_user| bigint| 上传人 ID（关联 user 表）|
| create_time| datetime| 上传时间|
| update_time| datetime| 最后编辑时间|
| is_deleted| tinyint| 是否删除（0 - 正常，1 - 回收站）|


#### 文件夹表（folder）
| **字段名** | **类型** | **说明** |
| :--- | :--- | :--- |
| id| bigint| 主键|
| name| varchar(100)| 文件夹名称|
| parent_id| bigint| 父文件夹 ID（0 为根目录）|
| create_user| bigint| 创建人 ID|
| create_time| datetime| 创建时间|


#### 论文 - 文件夹关联表（paper_folder）
| **字段名** | **类型** | **说明** |
| :--- | :--- | :--- |
| id| bigint| 主键|
| paper_id| bigint| 论文 ID|
| folder_id| bigint| 文件夹 ID|


#### 回收站表（recycle_bin）
| **字段名** | **类型** | **说明** |
| :--- | :--- | :--- |
| id| bigint| 主键|
| paper_id| bigint| 论文 ID|
| delete_time| datetime| 删除时间（用于定时清理）|
| delete_user| bigint| 删除人 ID|


#### 分享表（share）
| **字段名** | **类型** | **说明** |
| :--- | :--- | :--- |
| id| bigint| 主键|
| paper_id| bigint| 论文 ID|
| share_token| varchar(64)| 分享唯一标识（UUID）|
| expire_time| datetime| 过期时间（null 为永久）|
| permission| tinyint| 权限（1 - 仅查看，2 - 允许下载）|
| create_time| datetime| 创建时间|


#### 引用格式表（citation_format）
| **字段名** | **类型** | **说明** |
| :--- | :--- | :--- |
| id| bigint| 主键|
| name| varchar(50)| 格式名称（如 APA）|
| template| text| 模板（如`{author}.{title}[J]...`<br/>）|
| is_default| tinyint| 是否默认（1 - 是，0 - 否）|


## 3. 前端设计
### 3.1 页面结构
+ 登录页（/login）
+ 首页（/home）：左侧文件夹树 + 右侧论文列表
+ 论文详情页（/paper/:id）：信息编辑、引用生成、分享
+ 上传页（/upload）：单文件 / 批量上传组件
+ 回收站（/recycle）：已删除论文列表
+ 用户管理页（/user）：用户列表、新建用户

### 3.2 核心组件
+ `FileUpload`：文件上传组件（支持拖拽、进度条）
+ `PaperList`：论文列表（支持筛选、排序、批量操作）
+ `FolderTree`：文件夹树形组件（支持多级目录、拖拽）
+ `CitationGenerator`：引用生成组件（格式选择、预览、复制）

## 4. 后端设计
### 4.1 分层架构
```plain
Controller（接口层） → Service（业务逻辑层） → Mapper（数据访问层） → 数据库
```

### 4.2 核心模块流程
#### 4.2.1 论文上传流程
1. 前端上传文件 → 后端接收`MultipartFile`
2. 计算文件 MD5 哈希，检查是否已存在（查`paper`表`file_hash`）
3. 若不存在，保存文件到服务器目录（如`/data/papers/`）
4. 调用 PDF 解析工具提取元数据（标题、作者等）
5. 插入`paper`表记录，返回论文 ID

#### 4.2.2 大模型归纳流程
1. 用户触发归纳 → 后端读取论文文件文本
2. 调用大模型 API，传入提示词：

```plain
"请归纳以下论文的研究方向、创新点和不足：{论文文本}"
```

3. 解析 API 返回结果，更新`paper`表`research_direction`等字段
4. 保存历史版本（可选，新增`paper_induction_history`表）

#### 4.2.3 分享链接生成流程
1. 用户选择分享类型和权限 → 后端生成 32 位 UUID 作为`share_token`
2. 根据用户选择设置`expire_time`（如 7 天后）
3. 插入`share`表记录，返回`share_token`
4. 前端生成链接：`http://ip:port/share?token={share_token}`

### 4.3 关键技术实现
+ **文件去重**：通过`MessageDigest`计算 MD5 哈希，对比数据库记录。
+ **大模型集成**：封装 OpenAI SDK，配置 API Key，处理超时重试。
+ **回收站清理**：使用`@Scheduled`定时任务，每天凌晨删除 30 天前的记录。
+ **分享验证**：访问分享链接时，检查`share_token`是否存在且未过期。

